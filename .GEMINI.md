# Gemini Context & Development Guidelines

## HighLevelDetails

- **Summary:** This repository hosts the **OSM Event Browser**, a secure server-side Next.js application that interfaces with the Online Scout Manager (OSM) REST API. It features a secure proxy for API communication, OAuth 2.0 authentication, and data visualization for scout events.
- **Project Type:** Web Application (Next.js 16 App Router).
- **Language:** TypeScript (Strict Mode).
- **Styling:** Tailwind CSS v4, Shadcn/ui (Radix UI based), Lucide React icons.
- **Runtime:** Node.js (v20+).
- **Package Manager:** npm.

## Workflow & Protocols

- **Phased Implementation:** You must obtain **explicit user permission** before proceeding from one implementation phase to the next. Do not chain multiple phases in a single turn without confirmation.
- **Commit Strategy:**
  - Commit frequently to save progress.
  - **Mandatory:** Commit changes *before* marking a phase as complete and moving to the next.
  - Use descriptive commit messages that summarize the changes (e.g., "feat: implement OAuth callback handler").
- **Plan Updates:** The implementation plan (e.g., `docs/plan.md` or the active Todo list) must be updated to reflect the completed work before requesting permission to proceed.

## BuildInstructions

### Installation
- **Command:** `npm install`
- **Validation:** Run `npm install --dry-run` to verify dependency resolution.

### Development Server (HTTPS)
- **Context:** The project requires HTTPS for OAuth 2.0 callbacks with OSM.
- **Prerequisite:** Local certificates must be present in `.cert/` (generated via `mkcert`). See `HTTPS_SETUP.md`.
- **Command:** `npm run dev:https`
- **Validation:** Server starts at `https://localhost:3000`.

### Build
- **Command:** `npm run build`
- **Status:** Verified to pass.
- **Output:** Generates `.next/` directory with static and server-rendered pages.

### Linting
- **Command:** `npm run lint`
- **Status:** **Currently Failing.** The project has strict linting rules (including `no-explicit-any`), and there are approximately 40 existing errors.
- **Action:** Run this command to check your changes, but be aware of the existing baseline failures. Do not introduce *new* linting errors.

### Testing
- **Status:** No automated tests are currently implemented or configured in `package.json`.
- **Note:** A test plan exists in `docs/test-plan.md`, but dependencies (Vitest, Playwright) are not yet installed. Do not attempt to run `npm test`.

## ProjectLayout

### Architectural Overview
- **API Proxy (Critical):** All client-side requests to OSM must go through the internal proxy at `src/app/api/osm/[...path]/route.ts`. This handles token injection and refreshing server-side.
- **Authentication:** Implements OAuth 2.0 Authorization Code Flow. Logic resides in `src/lib/auth.ts` and `src/app/api/oauth-callback/`.
- **Core Logic:** OSM-specific logic (API client, parsing, data helpers) is located in `src/lib/osm/`.
- **UI Components:** Reusable components are in `src/components/ui/` (Shadcn) and `src/components/osm/`.

### Key Paths
- **Configuration:**
  - `next.config.ts`: Next.js configuration.
  - `eslint.config.mjs`: Linting rules.
  - `package.json`: Scripts and dependencies.
  - `server.js`: Custom HTTPS server entry point.
- **Documentation:**
  - `docs/architecture.md`: Security & Data Flow mandates (Source of Truth).
  - `docs/api-mapping.md`: OSM API endpoint details.
  - `GEMINI.md`: Original context file (superseded by this file for agent interactions, but contains valuable project history).

### Validation Steps
1. **Check Environment:** Ensure `.env.local` exists with `OSM_CLIENT_ID` and `OSM_CLIENT_SECRET`.
2. **Verify Certificates:** Ensure `.cert/key.pem` and `.cert/cert.pem` exist before starting the dev server.
3. **Build Check:** Run `npm run build` to ensure type safety and build integrity after changes.

### Dependencies
- **Production:** `next`, `react`, `lucide-react`, `tailwind-merge`, `clsx`.
- **Dev:** `eslint`, `typescript`, `tailwindcss` (v4).
